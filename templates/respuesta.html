<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <link rel="icon" type="image/png" sizes="32x32" href="../img/clipboard2-heart-fill.svg">
    <link rel="stylesheet" href="../css/respstyle.css">

    <title>Cuestionario | Responder cuestionario </title>
</head>

<body>
    <a href="./termina.html" class="sig">
        <div class="btn">
            <button class="sig" type="submit">Siguiente</button>

        </div>
    </a>

    <div class="cuestionario">
        <h1 id="title"></h1>
        <p id="descrip"></p>

        <table class="listitem">
            <tbody id="items">
            </tbody>
        </table>

        <script type="module">
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
            import { getDatabase, ref, set, get, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";

            const firebaseConfig = {
                apiKey: "AIzaSyBUtpFatRb8ubLIezntv_-aC5uqJ2ahAFw",
                authDomain: "ueqdatabase-26551.firebaseapp.com",
                databaseURL: "https://ueqdatabase-26551-default-rtdb.firebaseio.com",
                projectId: "ueqdatabase-26551",
                storageBucket: "ueqdatabase-26551.appspot.com",
                messagingSenderId: "275866539227",
                appId: "1:275866539227:web:d2ef1b9730c6a4863a28fe"
            };

            const app = initializeApp(firebaseConfig);
            const db = getDatabase();

            var Title = document.getElementById("title");
            var Descrip = document.getElementById("descrip");
            var Pin;

            function getPIN() {
                const dbref = ref(db);
                get(child(dbref, "PINResp")).then((snapshot) => {
                    if (snapshot.exists()) {
                        Pin = snapshot.val().PIN;
                        getData(Pin);
                    }
                    else {
                        alert("Error al buscar el PIN");
                    }
                })
                    .catch((error) => {
                        alert("ERROR" + error);
                    });
            }
            window.onload = getPIN;


            function getData(PIN) {
                const dbref = ref(db);
                get(child(dbref, "Cuestionarios/" + Pin)).then((snapshot) => {
                    if (snapshot.exists()) {
                        document.getElementById('title').innerHTML = snapshot.val().Titulo;
                        document.getElementById('descrip').innerHTML = snapshot.val().Descrip;
                        if (snapshot.val().Type = "UeqShort") {
                            getCuesShort();
                        }
                        else { 
                            getCues(); 
                        }
                    }
                    else {
                        document.getElementById('title').innerHTML = "Error: El cuestionario no existe, compruebe su PIN y vuelve a intentarlo";
                    }
                }).catch((error) => {
                    alert("Unexpected error " + error);
                });
            }

                var stn = 0;
                var tbody = document.getElementById("items");

            function additems(ID, Prop1, Prop2) {
                let trow = document.createElement("tr")
                let tdid = document.createElement("td");
                let tdpro1 = document.createElement("td");
                let tdpunt = document.createElement("td");
                let tdpro2 = document.createElement("td");

                tdid.innerHTML = ID;
                tdpro1.innerHTML = Prop1;
                tdpro2.innerHTML = Prop2;

                trow.appendChild(tdid);
                trow.appendChild(tdpro1);
                tdpunt = trow.insertCell();
                const radio = ['radio1', 'radio2', 'radio3', 'radio4', 'radio5', 'radio6', 'radio7'];
                const valor = [1, 2, 3, 4, 5, 6, 7];
                tdpunt.innerHTML = radio.map((radio) => `<input type="radio" name="radio1" value=~${valor} id=${radio}>`).join(' ');
                trow.appendChild(tdpro2);
                tbody.appendChild(trow);
            }

            function datos(items) {
                tbody.innerHTML = "";
                items.forEach(element => {
                    additems(element.ID, element.Prop1, element.Prop2);
                });
            }

            function getCuesShort() {
                const dbref = ref(db);

                get(child(dbref, "itemsShort")).then((snapshot) => {
                    var items = [];
                    snapshot.forEach(childSnapshot => {
                        items.push(childSnapshot.val());
                    });
                    datos(items);
                });
            }

            function getCues() {
                const dbref = ref(db);

                get(child(dbref, "items")).then((snapshot) => {
                    var items = [];
                    snapshot.forEach(childSnapshot => {
                        items.push(childSnapshot.val());
                    });
                    datos(items);
                });
            }
           


        </script>
    </div>

</body>




</html>